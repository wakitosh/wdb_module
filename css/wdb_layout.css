/**
 * @file
 * Defines the flexbox-based layout for the main viewer and panel container.
 */

/* Main container for the viewer and the side panel. */
#wdb-main-container {
  display: flex;
  flex-direction: row; /* Arrange elements horizontally. */
  min-height: 400px; /* It's good to specify a minimum height. */
  width: 100%;
  border: 1px solid #ccc;
}

/* The OpenSeadragon viewer itself. */
#openseadragon-viewer {
  flex: 1 1 auto; /* Use all remaining available space. */
  min-width: 200px; /* Minimum width. */
  background-color: #000;
}

/* The title of the annotation panel. */
#wdb-annotation-panel-title {
  padding: 10px;
  margin: 0;
  border-bottom: 1px solid #ccc;
  background-color: #f8f8f8;
  flex-shrink: 0; /* The title should not shrink. */
}

/* The right-side panel, which is a vertical flex container. */
#wdb-annotation-info-panel {
  display: flex;
  flex-direction: column; /* Arrange child elements vertically. */
  padding: 0;
  min-width: 150px;
  flex-basis: 270px;
  flex-shrink: 0;
  height: 100%;
  overflow-y: auto; /* Show scrollbar if content overflows. */
  font-size:0.8rem;
}

/* Content areas within the side panel. */
#wdb-annotation-panel-content,
#wdb-full-text-content {
  padding: 4px 10px 10px 10px;
  flex-grow: 1; /* Use all remaining space. */
  overflow-y: auto; /* Also scroll if content is long. */
  font-size:0.9rem;
  line-height: 1.5rem;
}

/* Upper panel (Annotation Details). */
#wdb-annotation-details-area {
  flex: 1 1 70%; /* Set initial height to 70%. */
  display: flex;
  flex-direction: column;
  min-height: 100px; /* Minimum height. */
  overflow: hidden; /* To enable scrolling on child elements. */
}

/* Control the display order in the annotation panel. */
.annotation-details-popup {
  display: flex;
  flex-direction: column;
}

/* Word block at the top. */
.annotation-detail-word {
  order: 1;
}

/* Sign block second. */
.annotation-detail-sign {
  order: 2;
}

/* Constituent signs list third. */
.annotation-detail-constituent-signs {
  order: 3;
}

#wdb-annotation-info-panel .annotation-detail-constituent-signs h3{
  margin: 0;
  padding: 0;
}

/* Lower panel (Full Text). */
#wdb-full-text-area {
  flex: 1 1 30%; /* Set initial height to 30%. */
  display: flex;
  flex-direction: column;
  min-height: 100px; /* Minimum height. */
  overflow: hidden; /* To enable scrolling on child elements. */
}

/* Styles for panel titles and content. */
#wdb-annotation-info-panel h3 {
  margin: 4px;
  padding: 0 6px;
  border-bottom: 1px solid #ccc;
  flex-shrink: 0; /* Title area should not shrink. */
  font-weight:bold;
  font-size: 0.9rem;
}


/* Handle for horizontal resizing (between viewer and panel). */
#wdb-resizer {
  flex-basis: 6px; /* Handle width. */
  flex-shrink: 0; /* Prevent the handle from shrinking. */
  background-color: #eee;
  cursor: col-resize; /* Set mouse cursor to horizontal resize. */
  height: 100%;
  border-left: 1px solid #ccc;
  border-right: 1px solid #ccc;
}
#wdb-resizer:hover {
  background-color: #ddd;
}

/* Handle for vertical resizing (between annotation details and full text). */
#wdb-resizer-horizontal {
  flex-basis: 6px; /* Handle height. */
  flex-shrink: 0;
  background-color: #eee;
  cursor: row-resize; /* Set mouse cursor to vertical resize. */
  width: 100%;
  border-top: 1px solid #ccc;
  border-bottom: 1px solid #ccc;
}
#wdb-resizer-horizontal:hover {
  background-color: #ddd;
}

/* ------------------------------ */
/* Responsive layout extensions   */
/* ------------------------------ */

/* Split mode: default (desktop). Nothing extra needed beyond base rules. */

/* Stacked mode: viewer over panel (mobile portrait). */
#wdb-main-container.layout--stacked {
  flex-direction: column;
}

#wdb-main-container.layout--stacked #wdb-resizer {
  display: none; /* Hide vertical resizer in stacked mode. */
}

#wdb-main-container.layout--stacked #openseadragon-viewer {
  flex: 1 1 60%;
  min-height: 200px;
}

#wdb-main-container.layout--stacked #wdb-annotation-info-panel {
  flex: 1 1 40%;
  min-height: 180px;
  /* Fixed 50:50 columns under toolbar */
  display: grid;
  grid-template-columns: 1fr 1fr; /* 50:50 */
  grid-template-rows: auto 1fr;
  grid-template-areas:
    "toolbar toolbar"
    "details fulltext";
  column-gap: 0;   /* no gap between columns (we draw a border) */
  row-gap: 8px;    /* keep vertical spacing */
}

/* Assign grid areas */
#wdb-main-container.layout--stacked #wdb-panel-toolbar { grid-area: toolbar; }
#wdb-main-container.layout--stacked #wdb-annotation-details-area { grid-area: details; }
#wdb-main-container.layout--stacked #wdb-full-text-area { grid-area: fulltext; }

/* Make sure children behave as blocks within grid (avoid flex-basis interference) */
#wdb-main-container.layout--stacked #wdb-annotation-details-area,
#wdb-main-container.layout--stacked #wdb-full-text-area {
  min-height: initial;
}

/* Vertical divider between Annotation and Full Text in stacked mode */
#wdb-main-container.layout--stacked #wdb-full-text-area {
  border-left: 1px solid #ccc;
}

/* Hide resizer in stacked (no drag) */
#wdb-main-container.layout--stacked #wdb-resizer-horizontal { display: none; }

/* Drawer resize handle removed (drag disabled) */


/* Drawer mode: panel overlays from bottom; viewer fills main area. */
#wdb-main-container.layout--drawer {
  position: relative;
  display: flex;
  flex-direction: column; /* Stack toolbar host and viewer */
}

/* Sticky toolbar host that will contain #wdb-panel-toolbar in drawer mode */
#wdb-toolbar-host {
  position: sticky;
  top: 0;
  z-index: 900; /* below drawer panel (1000) but above viewer */
}

#wdb-main-container.layout--drawer #wdb-resizer,
#wdb-main-container.layout--drawer #wdb-resizer-horizontal {
  display: none; /* Hide both resizers in drawer mode. */
}

/* Hide OpenSeadragon controls and navigator in drawer mode (mobile) */
#wdb-main-container.layout--drawer .openseadragon-container .openseadragon-controls,
#wdb-main-container.layout--drawer .openseadragon-container .openseadragon-navigator {
  display: none !important;
}

#wdb-main-container.layout--drawer #wdb-annotation-info-panel {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  height: 0;
  opacity: 0;
  pointer-events: none;
  transition: height .25s ease, opacity .25s ease, transform .25s ease;
  transform: translateY(6px);
  z-index: 1000;
  background: #fff;
  border-top: 1px solid #ccc;
  box-shadow: 0 -8px 24px rgba(0,0,0,0.25);
  /* Inner fixed layout for details/fulltext: 50:50 */
  display: grid;
  grid-template-columns: 1fr 1fr; /* 50:50 */
  grid-template-rows: 1fr;
  grid-template-areas: "details fulltext";
}

#wdb-main-container.layout--drawer.drawer-open #wdb-annotation-info-panel {
  height: 60vh;
  opacity: 1;
  pointer-events: auto;
  transform: translateY(0);
  overflow: auto;
}

/* Map areas in drawer */
#wdb-main-container.layout--drawer #wdb-annotation-details-area { grid-area: details; }
#wdb-main-container.layout--drawer #wdb-full-text-area { grid-area: fulltext; }
#wdb-main-container.layout--drawer #wdb-resizer-horizontal { display: none; }

/* Vertical divider between Annotation and Full Text in drawer mode */
#wdb-main-container.layout--drawer #wdb-full-text-area {
  border-left: 1px solid #ccc;
}

/* Floating action button to toggle panel (mobile) */
.wdb-panel-fab {
  position: fixed;
  right: 16px;
  bottom: 16px;
  z-index: 1100;
  background: #0b1220;
  color: #fff;
  border: 1px solid #334155;
  border-radius: 24px;
  padding: 10px 14px;
  font: inherit;
  cursor: pointer;
  box-shadow: 0 6px 18px rgba(0,0,0,0.35);
}

.wdb-panel-fab:focus {
  outline: 3px solid #38bdf8;
  outline-offset: 2px;
}

/* Sensible defaults by viewport width (can be overridden by JS) */
@media (max-width: 720px) {
  #wdb-main-container:not(.layout--drawer):not(.layout--stacked) {
    /* If no mode is set yet on small screens, use stacked as default. */
    flex-direction: column;
  }
}
